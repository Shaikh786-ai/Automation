name: Install Power Platform Application

# Trigger the workflow manually or on push to a branch
on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  install_app:
    runs-on: ubuntu-latest

    permissions:
      id-token: write
      contents: read

    steps:
      # 1️⃣ Checkout the repo
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2️⃣ Install Power Platform Tools (CLI)
      - name: Install Power Platform CLI
        uses: microsoft/powerplatform-actions/actions-install@v1

      # 3️⃣ Import CE / Dataverse Solution (CORRECTED)
      - name: Import CE Application Solution
        uses: microsoft/powerplatform-actions/import-solution@v1
        with:
          # URL of the target environment
          environment-url: ${{ secrets.PP_ENVIRONMENT_URL }}

          # Auth via Service Principal
          app-id: ${{ secrets.PP_CLIENT_ID }}
          tenant-id: ${{ secrets.PP_TENANT_ID }}
          client-secret: ${{ secrets.PP_CLIENT_SECRET }}

          # Path to the solution ZIP
          solution-file: ./app/MyAppPackage.zip

          # Overwrite existing solution
          force-overwrite: true
          publish-changes: true
