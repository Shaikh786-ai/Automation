name: Install D365 CE Applications

on:
  workflow_dispatch:

jobs:
  install-d365-apps:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Power Platform CLI
        run: |
          curl -sL https://aka.ms/install-pac-cli.sh | bash

      - name: Authenticate to Power Platform
        run: |
          pac auth create \
            --kind USERNAME_PASSWORD \
            --username "${{ secrets.PP_USERNAME }}" \
            --password "${{ secrets.PP_PASSWORD }}" \
            --tenant "${{ secrets.PP_TENANT_ID }}" \
            --environment "${{ secrets.PP_ENVIRONMENT_URL }}"

      - name: Install Dynamics 365 Sales
        run: |
          pac admin install \
            --application-name "Dynamics365Sales" \
            --environment "${{ secrets.PP_ENVIRONMENT_ID }}"
