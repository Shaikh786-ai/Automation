name: Delete UDE (OIDC, no secrets)

on:
  workflow_dispatch:

permissions:
  id-token: write   # required for GitHub OIDC
  contents: read

jobs:
  delete-ude:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Install PAC CLI wrapper actions
      - uses: microsoft/powerplatform-actions/actions-install@v1

      # Delete environment using federated credentials (no client secret)
      - name: Delete UDE environment
        uses: microsoft/powerplatform-actions/delete-environment@v1
        with:
          # OIDC: only app-id + tenant-id required when federated credentials are configured
          app-id:    ${{ secrets.PP_CLIENT_ID }}
          tenant-id: ${{ secrets.PP_TENANT_ID }}

          # Identify the environment to delete
          # Prefer the GUID (Environment ID). You can also use the unique name.
          environment-name: ude-dev01
          # Example (GUID): environment-name: 8d996ece-8558-4c4e-b459-a51b3beafdb4

          # Optional inputs that some runners support (uncomment if needed)
          # force: true              # skip prompts if action supports it
          # wait-for-completion: true
